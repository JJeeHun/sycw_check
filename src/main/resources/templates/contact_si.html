<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style>
        .box {
            display: flex;
            justify-content: space-between;
            height: 96vh;
        }
        .shipping, .plan, .picking, .closing, .sending753, .sending856 {
            border: 1px solid black;
            height: 100%;
            flex: 1;
            font-size: .7rem;
            transition: all .4s ease-in-out;
            overflow: auto;
        }

        .active {
            flex: 3;
        }

        h2 {
            text-align: center;
        }

        .row {
            display: flex;
            border-bottom: 1px solid black;
        }
        .row.header {
            border-top: 1px solid black;
            text-align: center;
        }

        .col {
            border-right: 1px solid black;
            flex:1;
            overflow: hidden;
            white-space: nowrap;
            padding: 0 5px;
        }

        .number {
            text-align: right;
        }

        .si_no {
            flex-basis: 100px;
        }

        .row .col:last-child {
            border-right: none;
        }

        .error {
            color: red !important;
            font-weight: bold;
        }

        div:not(.error) > .row .qty {
            color: #b01ae4;
            font-weight: bold;
            font-size: 0.75rem;
        }

        .summary {
            background-color: palegreen;
        }

        /* 전체 스크롤바 */
        ::-webkit-scrollbar {
            width: 5px; /* 스크롤바의 너비 */
        }

        /* 스크롤바의 트랙 */
        ::-webkit-scrollbar-track {
            background: lightgray; /* 트랙의 배경색 */
            border-radius: 10px; /* 트랙의 모서리를 둥글게 */
        }

        /* 스크롤바의 핸들 */
        ::-webkit-scrollbar-thumb {
            background: #888; /* 핸들의 배경색 */
            border-radius: 10px; /* 핸들의 모서리를 둥글게 */
        }

        /* 핸들이 호버될 때 */
        ::-webkit-scrollbar-thumb:hover {
            background: #555; /* 핸들이 호버될 때의 색상 */
        }

    </style>
</head>
<body>

    <div class="box">
        <div class="shipping">
            <h2>
                <label for="shipping-title">
                    <input type="checkbox" id="shipping-title">
                    Shipping Instruction
                </label>
            </h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="plan">
            <h2>
                <label for="plan-title">
                    <input type="checkbox" id="plan-title">
                    Plan
                </label>
            </h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="picking">
            <h2>
                <label for="picking-title">
                    <input type="checkbox" id="picking-title">
                    Picking
                </label>
            </h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="closing">
            <h2>
                <label for="closing-title">
                    <input type="checkbox" id="closing-title">
                    Closing
                </label>
            </h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
                <span class="col">CLOSING DATE</span>
            </div>
        </div>
        <div class="sending753">
            <h2>
                <label for="sending753-title">
                    <input type="checkbox" id="sending753-title">
                    Sending753
                </label>
            </h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="sending856">
            <h2>
                <label for="sending856-title">
                    <input type="checkbox" id="sending856-title">
                    Sending856
                </label>
            </h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SEQ</span>
                <span class="col">QTY</span>
            </div>
        </div>
    </div>


    <script>
        const shippingContainer = document.querySelector(".shipping");
        const planContainer     = document.querySelector(".plan");
        const pickingContainer  = document.querySelector(".picking");
        const closingContainer  = document.querySelector(".closing");
        const sending753Container  = document.querySelector(".sending753");
        const sending856Container  = document.querySelector(".sending856");
        const checkboxs = document.querySelectorAll('.box input');

        checkboxs.forEach(checkbox => checkbox.addEventListener('change', ({target}) => {
            target.closest('div').classList.toggle('active');
        }));


        const CreateShipping = (list,total) => {
            let sum = 0;
            const viewField = ['siNo','siItemNo','plannedQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow( rowData, viewField );
                sum += rowData?.plannedQty || 0;
                shippingContainer.append(rowNode);
            });
            if(total !== sum) shippingContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({plannedQty: sum}, viewField);
            shippingContainer.append(summaryNode);
        }

        const CreatePlan = (list,total) => {
            let sum = 0;
            const viewField = ['siNo','siItemNo','piPlanQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow( rowData, viewField );
                planContainer.append(rowNode);
                sum += rowData?.piPlanQty || 0;
            })

            if(total !== sum) planContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({piPlanQty:sum}, viewField);
            planContainer.append(summaryNode);
        }

        const CreatePicking = (list,total) => {
            let sum = 0;
            const viewField = ['siNo', 'siItemNo', 'pickingQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow( rowData, viewField);
                pickingContainer.append(rowNode);
                sum += rowData?.pickingQty || 0;
            })

            if(total !== sum) pickingContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({pickingQty:sum}, viewField);
            pickingContainer.append(summaryNode);
        }

        const CreateClosing = (list,total) => {
            let sum = 0;
            const viewField = ['siNo', 'siItemNo', 'qty', 'closingDate'];
            list.forEach( rowData => {
                const rowNode = CreateRow(rowData, viewField);
                closingContainer.append(rowNode);
                sum += rowData?.qty || 0;
            })

            if(total !== sum) closingContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({qty:sum}, viewField);
            closingContainer.append(summaryNode);
        }

        const CreateSending753 = (list,total) => {
            let sum = 0;
            const viewField = ['siNo', 'itemNo', 'itemQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow(rowData, viewField);
                sending753Container.append(rowNode);
                sum += rowData?.itemQty || 0;
            })

            if(total !== sum) sending753Container.classList.add('error');

            const summaryNode = CreateSummaryRow({itemQty:sum}, viewField);
            sending753Container.append(summaryNode);
        }

        const CreateSending856 = (list,total) => {
            let sum = 0;
            const viewField = ['siNo', 'seq', 'itemQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow(rowData, viewField);
                sending856Container.append(rowNode);
                sum += rowData?.itemQty || 0;
            })

            if(total !== sum) sending856Container.classList.add('error');

            const summaryNode = CreateSummaryRow({itemQty:sum}, viewField);
            sending856Container.append(summaryNode);
        }

        const CreateRow = (rowData,viewFields) => {
            const row = document.createElement('div');
            row.classList.add('row');

            viewFields.forEach(field => {
                const columnValue = rowData[field];
                const col = document.createElement('span');

                col.classList.add('col');
                col.textContent = field === 'closingDate' ? columnValue?.split('T')[0] : columnValue;
                col.title = columnValue;

                if(field === 'siNo') col.classList.add('si_no');
                if(field.toLowerCase().includes('qty')) col.classList.add('qty');
                if(!isNaN(columnValue)) col.classList.add('number');

                row.append(col);
            });

            return row;
        }

        const CreateSummaryRow = (rowData,viewFields) => {
            const row = document.createElement('div');
            row.classList.add('row');

            viewFields.forEach(field => {
                const columnValue = rowData[field];
                const col = document.createElement('span');

                col.classList.add('col','summary');
                col.textContent = columnValue;
                col.title = columnValue;

                if(field === 'siNo') col.classList.add('si_no');
                if(field.toLowerCase().includes('qty')) col.classList.add('qty');
                if(!isNaN(columnValue)) col.classList.add('number');

                row.append(col);
            });

            return row;
        }

    </script>

    <script th:inline="javascript">
        const orderItem = [[${orderItem}]];
        const shipping = [[${shipping}]];
        const plan = [[${plan}]];
        const picking = [[${picking}]];
        const closing = [[${closing}]];
        const sending753 = [[${sending753}]];
        const sending856 = [[${sending856}]];

        const total = orderItem.reduce((num, item) => num += item.itemQty || 0, 0);

        CreateShipping(shipping,total);
        CreatePlan(plan,total);
        CreatePicking(picking,total);
        CreateClosing(closing,total);
        CreateSending753(sending753,total);
        CreateSending856(sending856,total);
    </script>
</body>
</html>
