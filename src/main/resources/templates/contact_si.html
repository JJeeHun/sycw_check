<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style>
        .box {
            display: flex;
            justify-content: space-between;
            height: 96vh;
        }
        .shipping, .plan, .picking, .closing {
            border: 1px solid black;
            height: 100%;
            flex: 1;
            font-size: .7rem;
        }

        h2 {
            text-align: center;
        }

        .row {
            display: flex;
            border-bottom: 1px solid black;
        }
        .row.header {
            border-top: 1px solid black;
            text-align: center;
        }

        .col {
            border-right: 1px solid black;
            flex:1;
            overflow: hidden;
            white-space: nowrap;
            padding: 0 5px;
        }

        .number {
            text-align: right;
        }

        .si_no {
            flex-basis: 100px;
        }

        .row .col:last-child {
            border-right: none;
        }

        .error {
            color: red;
        }

        .summary {
            background-color: palegreen;
        }

    </style>
</head>
<body>

    <div class="box">
        <div class="shipping">
            <h2>Shipping Instruction</h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="plan">
            <h2>Plan</h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="picking">
            <h2>Picking</h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
            </div>
        </div>
        <div class="closing">
            <h2>Closing</h2>
            <div class="row header">
                <span class="col si_no">SI NO</span>
                <span class="col">SI ITEM NO</span>
                <span class="col">QTY</span>
                <span class="col">CLOSING DATE</span>
            </div>
        </div>
    </div>


    <script>
        const shippingContainer = document.querySelector(".shipping");
        const planContainer     = document.querySelector(".plan");
        const pickingContainer  = document.querySelector(".picking");
        const closingContainer  = document.querySelector(".closing");


        const CreateShipping = (list,total) => {
            let sum = 0;
            const viewField = ['siNo','siItemNo','plannedQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow( rowData, viewField );
                sum += rowData?.plannedQty || 0;
                shippingContainer.append(rowNode);
            });
            if(total !== sum) shippingContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({plannedQty: sum}, viewField);
            shippingContainer.append(summaryNode);
        }

        const CreatePlan = (list,total) => {
            let sum = 0;
            const viewField = ['siNo','siItemNo','piPlanQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow( rowData, viewField );
                planContainer.append(rowNode);
                sum += rowData?.piPlanQty || 0;
            })

            if(total !== sum) planContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({piPlanQty:sum}, viewField);
            planContainer.append(summaryNode);
        }

        const CreatePicking = (list,total) => {
            let sum = 0;
            const viewField = ['siNo', 'siItemNo', 'pickingQty'];
            list.forEach( rowData => {
                const rowNode = CreateRow( rowData, viewField);
                pickingContainer.append(rowNode);
                sum += rowData?.pickingQty || 0;
            })

            if(total !== sum) pickingContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({pickingQty:sum}, viewField);
            pickingContainer.append(summaryNode);
        }

        const CreateClosing = (list,total) => {
            let sum = 0;
            const viewField = ['siNo', 'siItemNo', 'qty', 'closingDate'];
            list.forEach( rowData => {
                const rowNode = CreateRow(rowData, viewField);
                closingContainer.append(rowNode);
                sum += rowData?.qty || 0;
            })

            if(total !== sum) closingContainer.classList.add('error');

            const summaryNode = CreateSummaryRow({qty:sum}, viewField);
            closingContainer.append(summaryNode);
        }

        const CreateRow = (rowData,viewFields) => {
            const row = document.createElement('div');
            row.classList.add('row');

            viewFields.forEach(field => {
                const columnValue = rowData[field];
                const col = document.createElement('span');

                col.classList.add('col');
                col.textContent = field === 'closingDate' ? columnValue?.split('T')[0] : columnValue;
                col.title = columnValue;

                if(field === 'siNo') col.classList.add('si_no');
                if(!isNaN(columnValue)) col.classList.add('number');

                row.append(col);
            });

            return row;
        }

        const CreateSummaryRow = (rowData,viewFields) => {
            const row = document.createElement('div');
            row.classList.add('row');

            viewFields.forEach(field => {
                const columnValue = rowData[field];
                const col = document.createElement('span');

                col.classList.add('col','summary');
                col.textContent = columnValue;
                col.title = columnValue;

                if(field === 'siNo') col.classList.add('si_no');
                if(!isNaN(columnValue)) col.classList.add('number');

                row.append(col);
            });

            return row;
        }

    </script>

    <script th:inline="javascript">
        const orderItem = [[${orderItem}]];
        const shipping = [[${shipping}]];
        const plan = [[${plan}]];
        const picking = [[${picking}]];
        const closing = [[${closing}]];

        const total = orderItem.reduce((num, item) => num += item.itemQty || 0, 0);

        CreateShipping(shipping,total);
        CreatePlan(plan,total);
        CreatePicking(picking,total);
        CreateClosing(closing,total);
    </script>
</body>
</html>
